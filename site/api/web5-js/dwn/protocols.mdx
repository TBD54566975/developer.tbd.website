import Divider from '@site/src/components/Divider';
import ApiDetails from '@site/src/components/ApiDetails';

# protocols

## Overview
The `protocols` class is responsible for providing convenience methods for managing protocols between DWNs

<Divider type="slash"/>

<section class="api-docs">

## Methods

<br/>

### configure(request)

Configures a protocol definition in the user's local DWN, remote DWN, or another party's DWN (if permitted). Fields under the `structure` object of the Protocol definition are expected to be one of the type references matching those defined in the `types` object. The type structures are recursive, so types form a graph and each type can have within it further attached types or rule statements that are all denoted with the prefix $.

:::note
In order to also send the protocol to remote DWNs, configure() should be followed by `protocol.send(did)`
:::

#### Parameters

<ApiDetails
  details={[
    {
      data: {
        isObject: true,
        type: 'ProtocolsConfigureRequest',
        field: 'request',
        value: <ApiDetails
                details={[
                {
                  data: {
                    isObject: true,
                    type: 'ProtocolsConfigureOptions',
                    field: 'message',
                    value: <ApiDetails
                            details={[
                            {
                                data: {
                                    isObject: true,
                                    type: 'ProtocolDefinition',
                                    field: 'definition',
                                    value: <ApiDetails
                                            details={[
                                            {
                                                data: {
                                                    type: 'string',
                                                    field: 'protocol',
                                                    value: 'URI that represents the protocol being configured',
                                                },
                                            },
                                            {
                                                data: {
                                                    isObject: true,
                                                    type: 'ProtocolTypes',
                                                    field: 'types',
                                                    value: <ApiDetails
                                                            details={[
                                                            {
                                                                data: {
                                                                    isOptional: true,
                                                                    type: 'string',
                                                                    field: 'schema',
                                                                    value: 'URI of the schema under which the records will be bucketed',
                                                                },
                                                            },
                                                            {
                                                                data: {
                                                                    isOptional: true,
                                                                    type: 'string[]',
                                                                    field: 'dataFormats',
                                                                    value: 'Array of the IANA strings corresponding with the formats of how the data will be bucketed. See IANA\'s Media Type list here: https://www.iana.org/assignments/media-types/media-types.xhtml',
                                                                },
                                                            },                              
                                                        ]}
                                                      />,
                                                },
                                            }, 
                                            {
                                                data: {
                                                    isObject: true,
                                                    type: 'ProtocolRuleSet',
                                                    field: 'structure',
                                                    value: <ApiDetails
                                                            details={[
                                                            {
                                                                data: {
                                                                    isObject: true,
                                                                    type: 'ProtocolActionRule[]',
                                                                    field: '$actions',
                                                                    value: <ApiDetails
                                                                            details={[
                                                                            {
                                                                              data: {
                                                                                type: 'string',
                                                                                field: 'who',
                                                                                value: 'The actor that is being permitted to invoke a given action. Valid values are: author, recipient',
                                                                              },
                                                                            },
                                                                            {
                                                                              data: {
                                                                                isOptional: true,
                                                                                type: 'string',
                                                                                field: 'of',
                                                                                value: 'The protocol path that refers to the record subject',
                                                                              },
                                                                            }, 
                                                                            {
                                                                              data: {
                                                                                type: 'string',
                                                                                field: 'can',
                                                                                value: 'The action being permitted by the rule',
                                                                              }
                                                                            },                             
                                                                        ]}
                                                                      />,
                                                                },
                                                            },                              
                                                        ]}
                                                      />,
                                                },
                                            },                                                             
                                        ]}
                                      />,
                                },
                            },                                            
                        ]}
                      />,
                  },
                },
              ]}
          />
      },
    },
  ]}
/>


#### Return Value

<ApiDetails
  details={[
    {
      data: {
        field: 'ProtocolsConfigureResponse',
        value: 'A response object containing the status of the request and a Protocol object if successful',
      },
    },
  ]}
/>



#### Code Example

```js
const { protocol } = await web5.dwn.protocols.configure({
  message: {
    definition: {
      protocol: "https://photos.org/protocol",
      types: {
        album: {
          schema: "https://photos.org/protocol/album",
          dataFormats: ["application/json"],
        },
        photo: {
          schema: "https://photos.org/protocols/photo",
          dataFormats: ["application/json"],
        },
        binaryImage: {
          dataFormats: ["image/png", "jpeg", "gif"],
        },
      },
      structure: {
        album: {
          $actions: [
            {
              who: "recipient",
              can: "read",
            },
          ],
        },
        photo: {
          $actions: [
            {
              who: "recipient",
              can: "read",
            },
          ],
          binaryImage: {
            $actions: [
              {
                who: "author",
                of: "photo",
                can: "write",
              },
            ],
          },
        },
      },
    },
  },
});

protocol.send(myDid); //sends the protocol configuration to the user's other DWNs.
```

<Divider type="slash"/>

### query(request)

Queries a DID's DWNs for the presence of a protocol. This method is useful in detecting what protocols a given DID has installed to enable interaction over the protocol.

#### Parameters

<ApiDetails
  details={[
    {
      data: {
        isObject: true,
        type: 'ProtocolsQueryRequest',
        field: 'request',
        value: <ApiDetails
                details={[
                {
                    data: {
                        isOptional: true,
                        type: 'string',
                        field: 'from',
                        value: 'The DID of the DWN to query',
                    },
                },
                {
                    data: {
                        isObject: true,
                        type: 'ProtocolsQueryOptions',
                        field: 'message',
                        value: <ApiDetails
                                details={[
                                {
                                    data: {
                                        isOptional: true,
                                        type: 'string',
                                        field: 'dateCreated',
                                        value: 'Date of creation for the protocols to query',
                                    }
                                },                           
                                {
                                    data: {
                                        isObject: true,
                                        isOptional: true,
                                        type: 'ProtocolsQueryFilter',
                                        field: 'filter',
                                        value: <ApiDetails
                                                details={[
                                                {
                                                    data: {
                                                        type: 'string',
                                                        isOptional: true,
                                                        field: 'protocol',
                                                        value: 'URI of the protocol bucket in which to query',
                                                    },
                                                },  
                                            ]}
                                        />,
                                    },
                                },                            
                            ]}
                        />,
                    },
                },                                             
            ]}
          />,
      },
    },
  ]}
/>


#### Return Value

<ApiDetails
  details={[
    {
      data: {
        field: 'ProtocolsQueryResponse',
        value: 'A response object containing the status of the request and an array of matching Protocol objects',
      },
    },
  ]}
/>


#### Code Examples

```js
const { protocols } = await web5.dwn.protocols.query({
  message: {
    filter: {
      protocol: "https://music.org/protocol",
    },
  },
});

// logs an array of protocol configurations installed on the user's DWN
console.log(protocols);
```

```js
const { protocols } = await web5.dwn.protocols.query({
  //highlight-start
  from: "did:example:bob",
  //highlight-end
  message: {
    filter: {
      protocol: "https://music.org/protocol",
    },
  },
});

// logs an array of protocol configurations installed on Bob's DWN
console.log(protocols);
```
</section>
