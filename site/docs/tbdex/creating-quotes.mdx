---
sidebar_position: 7
---

# Creating Quotes

When your PFI receives an RFQ message, you’ll want to do the following:



* Store the RFQ message in your database
* Filter through your Offerings based on the RFQ to see if there is an Offering or many Offerings for which the RFQ would qualify
* Verify the Wallet’s credentials as required by the Offering selected
* Create a Quote and store it in your PFI database

RFQ storage was discussed in the [Exchange API Provider](docs/tbdex/anatomy-of-a-pfi) section, so this section will discuss the next 3 steps.


### Find an Offering

After inserting the RFQ you received into your database, you’ll want to search your offerings database for the Offering the RFQ is requesting. RFQs contain a required `offeringId` field that you can call your Offerings API provider’s `getOffering()` method to find exactly what you’re looking for. Building on the example from our [Exchange API Provider section](docs/tbdex/anatomy-of-a-pfi), your code might look like this:


```js
async write(opts: { message: MessageKindClass }) {
   const { message } = opts
   const subject = aliceMessageKinds.has(message.kind) ? message.from : message.to

   const result = await dataProvider.insert(
       'exchange',
     {
       exchangeid: message.exchangeId,
       messagekind: message.kind,
       messageid: message.id,
       subject,
       message: JSON.stringify(message)
     });

   if (message.kind == 'rfq') {
     const offering = await offeringApiProvider.getOffering(message.offeringId)
   }
}
```



### Verifying the Wallet’s Credentials

After receiving an RFQ and finding the matching Offering for it, you’ll want to verify that the Wallet satisfies the necessary requirements for the Offering. The RFQ class offers the `[verifyOfferingRequirements](https://developer.tbd.website/docs/tbdex/api-reference/tbdex-js/protocol/classes/rfq/#verifyofferingrequirements)` method to do so, which uses PEX to check that the claim or credential provided in the RFQ satisfies the presentation definition that was given on the offering. That may look like this:


```js
 function processRfq(rfq, offering) {
     try {
      await rfq.verifyOfferingRequirements(offering)
    } catch(e) {
      console.log(`Failed to verify offering requirements: ${e.rfq}`)
    }
}
```



### Creating and Sending Your Quote

Before creating your quote from the RFQ and the matching Offering, you may want to review the [protocol definition for Quotes](https://github.com/TBD54566975/tbdex/tree/main/specs/protocol#quote). With that in mind, you can then create your quote using the `Quote.create()` method as shown below:


```js
const quote = Quote.create(
        {
          metadata: {
            from: config.did.id,
            to: message.from,
            exchangeId: message.exchangeId
          },
          data: {
            expiresAt: new Date(2024, 4, 1).toISOString(),
            payin: {
              currencyCode: 'BTC',
              amountSubunits: '1000'
            },
            payout: {
              currencyCode: 'KES',
              amountSubunits: '123456789'
            }
          }
        }
      )
```


With your quote created, you’ll then want to sign it for verification purposes and write it to your own database:


```js
await quote.sign(config.did.privateKey, config.did.kid)
this.write({ message: quote as Quote})
```


Currently, Wallets are not pushed updates about Quotes because wallets are not addressable; therefore the customer’s wallet will need to poll your PFI’s database in order to get the Quote from you.
