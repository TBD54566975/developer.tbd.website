---
sidebar_position: 2
title: 'Quickstart: PFI'
hide_title: true
hide_table_of_contents: false
---

import { QuickstartExecutionProvider } from '@site/src/components/QuickstartExecutionContext';
import Version from '@site/src/components/Version';
import PackageJson from '@site/src/components/PackageJson';
import CodeSnippet from '@site/src/components/CodeSnippet';
import PfiQuickstartCodeRunner from '@site/src/components/PfiQuickstartCodeRunner';

<QuickstartExecutionProvider>

# tbDEX PFI in 5️⃣ Minutes

## Overview

A [Participating Financial Institution (PFI)](/docs/tbdex/pfi/overview) in the tbDEX ecosystem provides liquidity offerings to customers via Wallets. Customers can place orders and execute transactions if they meet the necessary requirements.

**In this quickstart, you'll:**

- Set up a basic PFI with offerings
- Open endpoints for tbDEX-enabled Wallets
- Process Requests for Quote and respond with Quotes
- Handle Orders, provide `OrderStatus` updates, and close out Orders

Let's get started!

## Building a Simple PFI

### Create a DID

PFIs on tbDEX are identified using [Decentralized Identifiers (DIDs)](/docs/web5/decentralized-identifiers/what-are-dids). Let's create a DID for your PFI and specify a service endpoint for wallet applications to interact with your PFI:

<CodeSnippet snippetName="pfiOverviewCreateDid" />
<PfiQuickstartCodeRunner executeCodeName="executeDidCreate" stepIndex={0} customPlaceholder={"See PFI DID"} />

### Structure Your PFI App

PFIs are [Express](https://expressjs.com/) servers enhanced with the [tbDEX SDK](/docs/tbdex/). You'll need a:

- Server
- Database (e.g., PostgreSQL) with tables for offerings and exchanges
There are two primary components to a PFI:

- [OfferingsApi](/docs/tbdex/pfi/anatomy-of-a-pfi/#offerings-api-provider): Allows Wallets to query available offerings
- [ExchangesApi](/docs/tbdex/pfi/anatomy-of-a-pfi/#exchange-api-provider): Handles RFQs, Orders, and exchange closures

#### Extend the `OfferingsApi` and `ExchangesApi` Interfaces
With your own custom database setup, you can extend the `OfferingsApi` and `ExchangesApi` interfaces with instructions to manage the database containing your offerings and exchanges.

Learn more about how to do this in detail in this [guide](/docs/tbdex/pfi/anatomy-of-a-pfi).

{/* First, we implement the `ExchangesApiProvider` class by focusing on the `write` function to handle exchange data:

<CodeSnippet snippetName="pfiOverviewWriteJs" title="exchangesApiProvider.ts" />

Next, we implement the `OfferingsApiProvider` class which also stores and fetches the PFI's list of offerings when requested by a Wallet:

<CodeSnippet snippetName="pfiOverviewReadOfferingsJs" title="offeringsApiProvider.ts" /> */}

#### Create your server instance of `TbdexHttpServer`
Create your main server entry point in `main.ts`, with an instance of `TbdexHttpServer` passing the `exchangesApi`, `offeringsApi` and the `pfiDid`.

<CodeSnippet snippetName="pfiOverviewConfigJs" title="main.ts" />



{/* Next we need to configure the PFI to know how to react when it receives specific types of messages from the customer. To be able to create quotes, handle orders and close out the exchange using the `write` method.

<CodeSnippet snippetName="pfiOverviewServerRoutesJs" title="main.ts" /> */}

## Building Out Offerings

Without Offerings, your PFI doesn't have anything to present to customers. [Create an Offering](/docs/tbdex/pfi/creating-offerings) to swap `USD` for `KES` and insert it into your `offerings` table.

Here's an example:

<CodeSnippet snippetName="pfiCreateQuickstartOfferingJs" title="offeringsApiProvider.ts" />

{/* <PfiQuickstartCodeRunner executeCodeName="executeAddOffering" stepIndex={1} customPlaceholder={"Add the Offering to the PFI"} viewJsonObj={true} collapseLevel={3} /> */}

### Fetching Offerings for Wallets

With your `offeringsApi` all setup to return offerings when requested, this is what wallet providers would receive when they call `TbdexHttpClient.getOfferings()` :

<PfiQuickstartCodeRunner executeCodeName="executeGetOfferings" stepIndex={1} customPlaceholder={"Fetch offerings from the PFI Endpoint"} viewJsonObj={true} collapseLevel={3} />

## Processing tbDEX Messages

### Processing RFQs and Returning Quotes

When a customer selects an offering, they make a `Request for Quote` along with their credentials that match the `requiredClaims` of the offering. Using this submitted data, your PFI generates a  `Quote`:

<CodeSnippet snippetName="pfiCreateQuoteJs" title="exchangeApiProvider.ts" />
<PfiQuickstartCodeRunner executeCodeName="executeGetQuote" stepIndex={2} customPlaceholder={"See the Quote"} viewJsonObj={true} collapseLevel={1} />

### Receiving Orders and Returning OrderStatus

The customer has accepted the quote and places an order. Let's process accepted Quotes, manage Orders, and send `OrderStatus` updates:

<CodeSnippet snippetName="pfiOrderStatusJs" title="exchangeApiProvider.ts" />
<PfiQuickstartCodeRunner executeCodeName="executeGetOrderStatus" stepIndex={3} customPlaceholder={"See the OrderStatus"} viewJsonObj={true} collapseLevel={1} />

### Closing Out Orders

Once the order is fulfilled, or cancelled by the PFI for whatever reason, you close orders with a `Close` message along with the `reason`:

<CodeSnippet snippetName="pfiCloseOrderJs" title="exchangeApiProvider.ts" />
<PfiQuickstartCodeRunner executeCodeName="executeGetClose" stepIndex={4} customPlaceholder={"See the Close Message"} viewJsonObj={true} collapseLevel={1} />

## Next Steps with tbDEX

Congratulations on building your first PFI! To explore further, check out the full [PFI guide](/docs/tbdex/pfi/overview) or learn about [building a Wallet](/docs/tbdex/wallet/overview) and [becoming a Credential Issuer](/docs/tbdex/issuer/overview).


</QuickstartExecutionProvider>
